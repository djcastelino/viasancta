# ğŸ”§ n8n Workflow Setup for Trivia (RECOMMENDED)

This is the **easiest** way to set up trivia generation! No need to add API keys to Vercel - everything happens in n8n.

## âœ… Why n8n?

- âœ… **Easy troubleshooting** - Visual interface
- âœ… **No Vercel env variables** needed
- âœ… **You control everything** in one place
- âœ… **Already have Groq set up** in n8n
- âœ… **Can test instantly** with n8n UI

## ğŸš€ Quick Setup (5 minutes)

### Step 1: Import Workflow to n8n

1. Open your n8n instance
2. Click **"Import from File"**
3. Select `n8n-trivia-workflow.json` from this project
4. The workflow will be imported

### Step 2: Configure Groq in n8n

1. Click on the **"Groq"** node in the workflow
2. Add your Groq credentials:
   - API Key: `gsk_your_groq_api_key_here` (use your actual key)
   - Model: `llama-3.3-70b-versatile` (already selected)
3. Save the credential

### Step 3: Activate Webhook

1. Click on the **"Webhook"** node
2. Copy the **Production URL** (looks like: `https://your-n8n.app.n8n.cloud/webhook/scripture-trivia`)
3. **Activate** the workflow

### Step 4: Add Webhook URL to Your App

#### Option A: Using .env.local (for local development)
```bash
# Add to /Users/dcasteli/Documents/pda/viasancta/.env.local
N8N_TRIVIA_WEBHOOK_URL=https://your-n8n.app.n8n.cloud/webhook/scripture-trivia
```

#### Option B: Using Vercel (for production)
1. Go to Vercel project settings
2. Add environment variable:
   - Name: `N8N_TRIVIA_WEBHOOK_URL`
   - Value: `https://your-n8n.app.n8n.cloud/webhook/scripture-trivia`
3. Redeploy

### Step 5: Test It!

1. Go to your app: `/challenge`
2. Complete a challenge
3. Click **"ğŸ“š Learn More"**
4. You should see trivia generated by Groq via n8n!

## ğŸ§ª Testing in n8n

Before connecting to your app, test the workflow:

1. Click **"Execute Workflow"** in n8n
2. Send test data:
```json
{
  "name": "Moses",
  "testament": "Old",
  "role": "Prophet & Leader",
  "famousFor": "Led the Exodus from Egypt and received the Ten Commandments",
  "books": ["Exodus", "Numbers", "Deuteronomy"]
}
```
3. Check the output - should be 2 sentences of trivia

## ğŸ“Š Workflow Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webhook   â”‚ â† Receives challenge data from your app
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Groq     â”‚ â† Generates trivia with Llama 3.3
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Format    â”‚ â† Formats response as JSON
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Respond   â”‚ â† Returns trivia to your app
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Troubleshooting

### Trivia shows fallback text
1. Check n8n workflow is **activated**
2. Check webhook URL is correct in `.env.local`
3. Check Groq credentials in n8n
4. Look at n8n execution logs

### n8n execution fails
1. Click on the failed execution in n8n
2. See exactly which node failed
3. Check the input/output data
4. Fix and retry

### Webhook URL not working
1. Make sure workflow is **active** (toggle at top)
2. Use the **Production URL**, not Test URL
3. Restart your dev server after adding URL

## ğŸ’¡ Advantages Over Direct API

**With n8n:**
- âœ… Visual debugging - see exactly what's happening
- âœ… Can add caching, logging, error handling visually
- âœ… Can chain multiple AI calls if needed
- âœ… No code changes needed to modify prompt
- âœ… All logs in one place
- âœ… No Vercel env variable needed (just n8n webhook URL)

**Direct API approach:**
- âŒ Need to deploy code changes to test
- âŒ Harder to debug errors
- âŒ Need to add GROQ_API_KEY to Vercel
- âŒ Restart required for changes

## ğŸ¯ You're Done!

Once configured, the trivia feature will:
1. Call your n8n webhook
2. n8n generates trivia with Groq
3. Returns beautiful "Did you know..." facts
4. Text-to-speech reads it aloud!

**All managed in n8n's visual interface!** ğŸ‰
